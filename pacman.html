<!DOCTYPE html>
<html>
<head>
    <title>Pacman</title>
    <meta charsset="utf-8">
    <style>
        .board{
            border: 0px solid black;
        }
        .board-padding{
            background-color: whilte;
            border: 0px solid black;
            box-shadow: 10px 10px 30px rgba(0,0,0,0.5);
            padding: calc(var(--cell-size) / 2);
        }
    </style>
</head>

<body>
    <div id="tableMap" class="board-padding board"></div>
    <img id="divMan" src="pacman.png" style="position: absolute; left: 28px; top: 28px;"></img>
</body>
<script>
var divMan = document.getElementById('divMan');
var tableBoard = document.getElementById('tableMap');

var man = {
    dir: 2, // 1 : up, 2: right, 3: down, 4: left
    next_dir:2,
    speed:2,
    animation:1
}

function map(x, y) {
    return arrMap[y][x];
}

var arrMap = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1],
    [1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
]

drawBoard();

var arrStar = [];
setInterval(main, 17);
//setInterval(animation, 100);

function main() {
    moveBall();
}

function animation() {
    if(man.animation == 1) {
        man.animation = 2;
        divMan.src="pacman2.png";
    } else {
        man.animation = 1;
        divMan.src="pacman.png";
    }
}

document.onkeypress = function(e) {
    switch(e.keyCode) {
    case 119:
        man.next_dir = 1;
        break;
    case 100:
        man.next_dir = 2;
        break;
    case 115:
        man.next_dir = 3;
        break;
    case 97:
        man.next_dir = 4;
        break;
    }
}

function moveBall() {
    real_x = Number(divMan.style.left.split("px")[0]);
    real_y = Number(divMan.style.top.split("px")[0]);
    man.x = Math.floor(real_x/28);
    man.y = Math.floor(real_y/28);
    console.log("x : " + real_x % 28);
    console.log("y : " + real_y % 28);
    if(real_x % 28 == 0 && real_y % 28 == 0) {
        switch(man.next_dir) {
        case 1:
            if(map(man.x, man.y-1) != 1) {
                man.dir = man.next_dir;
                man.next_dir = 0;
            }
            break;
        case 2:
            if(map(man.x+1, man.y) != 1) {
                man.dir = man.next_dir;
                man.next_dir = 0;
            }
            break;
        case 3:
            if(map(man.x, man.y+1) != 1) {
                man.dir = man.next_dir;
                man.next_dir = 0;
            }
            break;
        case 4:
            if(map(man.x-1, man.y) != 1) {
                man.dir = man.next_dir;
                man.next_dir = 0;
            }
            break;
        }
    }

    if(man.dir == 1 && man.next_dir == 3) {
        man.dir = man.next_dir;
        man.next_dir = 0;
    } else if(man.dir == 2 && man.next_dir == 4) {
        man.dir = man.next_dir;
        man.next_dir = 0;
    } else if(man.dir == 3 && man.next_dir == 1) {
        man.dir = man.next_dir;
        man.next_dir = 0;
    } else if(man.dir == 4 && man.next_dir == 2) {
        man.dir = man.next_dir;
        man.next_dir = 0;
    }
    
    switch(man.dir) {
    case 1:
        if(map(man.x, Math.floor((real_y-2)/28)) == 0) {
            divMan.style.top = real_y - 2 + "px";
        }
        break;
    case 2:
        if(map(Math.floor((real_x+2+28-1)/28), man.y) == 0) {
            divMan.style.left = real_x + 2 + "px";
        }
        break;
    case 3:
        if(map(man.x, Math.floor((real_y+2+28-1)/28)) == 0) {
            divMan.style.top = real_y + 2 + "px";
        }
        break;
    case 4:
        if(map(Math.floor((real_x-2)/28), man.y) == 0) {
            divMan.style.left = real_x - 2 + "px";
        }
        break;
    }
}

function drawBoard() {
    for(var i = 0; i < arrMap.length; i++) {
        for(var j = 0; j < arrMap[i].length; j++) {
            var cell = document.createElement('div');
            cell.style.position = 'absolute';
            cell.style.height = "28px";
            cell.style.width = "28px";
            cell.style.left = j * 28 + "px";
            cell.style.top = i * 28 + "px";

            if(arrMap[i][j] == 0) {
                cell.style.backgroundColor = "black";
            } else {
                cell.style.backgroundColor = "blue";
            }

            tableBoard.appendChild(cell);
        }
    }
}
</script>
</html>